const translations = {
  en: {
    logo: '7rayfi',
    hero: {
      title: 'Find or Offer Professional Services',
      subtitle: 'Connect with skilled professionals or showcase your expertise',
      question: 'What brings you here?',
      findService: 'Find a Service',
      offerService: 'Offer a Service',
      getStarted: 'Get Started',
    },
    stats: {
      professionals: 'Professionals',
      services: 'Services Completed',
      satisfaction: 'Satisfaction Rate',
      support: 'Support Available',
    },
    howItWorks: {
      title: 'How It Works',
      findPath: {
        title: 'Looking for a Service',
        step1: {
          title: 'Search & Browse',
          description: 'Find professionals by category, location, or expertise',
        },
        step2: {
          title: 'Review & Connect',
          description: 'Check ratings, reviews, and contact the right professional',
        },
        step3: {
          title: 'Get It Done',
          description: 'Work with confidence and leave a review after completion',
        },
      },
      offerPath: {
        title: 'Offering a Service',
        step1: {
          title: 'Create Profile',
          description: 'Set up your professional profile with skills and portfolio',
        },
        step2: {
          title: 'Get Discovered',
          description: 'Be visible to thousands of potential clients in your area',
        },
        step3: {
          title: 'Grow Business',
          description: 'Build reputation through reviews and expand your client base',
        },
      },
    },
    testimonials: {
      title: 'What Our Users Say',
      items: [
        {
          text: 'Found an excellent plumber within minutes. The service was fast and professional. Highly recommend!',
          name: 'Sarah M.',
          role: 'Homeowner',
        },
        {
          text: 'As a freelancer, this platform helped me grow my client base by 300% in 6 months!',
          name: 'Karim B.',
          role: 'Graphic Designer',
        },
        {
          text: "The rating system helps me trust the professionals. I've never been disappointed!",
          name: 'Amina L.',
          role: 'Business Owner',
        },
      ],
    },
    faq: {
      title: 'Frequently Asked Questions',
      items: [
        {
          question: 'How do I get started?',
          answer:
            'Simply choose whether you want to find or offer a service, create an account, and start exploring. It takes less than 2 minutes to get started!',
        },
        {
          question: 'Is the service free?',
          answer:
            'Creating an account and browsing services is completely free. We only charge a small service fee on completed transactions to maintain the platform.',
        },
        {
          question: 'How are professionals verified?',
          answer:
            'All professionals go through a verification process including ID verification, skill assessment, and background checks. We also maintain a review system for transparency.',
        },
        {
          question: "What if I'm not satisfied?",
          answer:
            "We offer a satisfaction guarantee. If you're not happy with a service, contact our support team within 48 hours, and we'll work to resolve the issue or provide a refund.",
        },
        {
          question: 'Can I offer multiple services?',
          answer:
            "Yes! You can list as many services as you'd like on your professional profile. This helps you reach more clients across different categories.",
        },
      ],
    },
    contact: {
      title: 'Get in Touch',
      description:
        "Have questions or need assistance? We're here to help. Reach out to our support team anytime.",
      form: {
        name: 'Your Name',
        email: 'Email Address',
        message: 'Message',
        submit: 'Send Message',
      },
    },
    footer: {
      about: {
        title: 'About 7rayfi',
        text: 'Connecting professionals with clients across various services.',
      },
      links: {
        title: 'Quick Links',
        about: 'About Us',
        terms: 'Terms of Service',
        privacy: 'Privacy Policy',
      },
      support: {
        title: 'Support',
        help: 'Help Center',
        contact: 'Contact Us',
        faq: 'FAQ',
      },
      copyright: '© 2024 7rayfi. All rights reserved.',
    },
  },
  fr: {
    logo: '7rayfi',
    hero: {
      title: 'Trouvez ou Offrez des Services Professionnels',
      subtitle:
        'Connectez-vous avec des professionnels qualifiés ou mettez en valeur votre expertise',
      question: 'Que recherchez-vous?',
      findService: 'Trouver un Service',
      offerService: 'Offrir un Service',
      getStarted: 'Commencer',
    },
    stats: {
      professionals: 'Professionnels',
      services: 'Services Complétés',
      satisfaction: 'Taux de Satisfaction',
      support: 'Support Disponible',
    },
    howItWorks: {
      title: 'Comment Ça Marche',
      findPath: {
        title: 'Recherche de Service',
        step1: {
          title: 'Rechercher & Parcourir',
          description: 'Trouvez des professionnels par catégorie, lieu ou expertise',
        },
        step2: {
          title: 'Évaluer & Connecter',
          description: 'Vérifiez les notes, avis et contactez le bon professionnel',
        },
        step3: {
          title: 'Réalisez-le',
          description: 'Travaillez en toute confiance et laissez un avis après achèvement',
        },
      },
      offerPath: {
        title: 'Offre de Service',
        step1: {
          title: 'Créer un Profil',
          description: 'Configurez votre profil professionnel avec compétences et portfolio',
        },
        step2: {
          title: 'Être Découvert',
          description: 'Soyez visible par des milliers de clients potentiels dans votre région',
        },
        step3: {
          title: 'Développer Affaires',
          description: 'Construisez votre réputation grâce aux avis et élargissez votre clientèle',
        },
      },
    },
    testimonials: {
      title: 'Ce que Disent Nos Utilisateurs',
      items: [
        {
          text: 'Trouvé un excellent plombier en quelques minutes. Le service était rapide et professionnel. Je recommande vivement!',
          name: 'Sarah M.',
          role: 'Propriétaire',
        },
        {
          text: "En tant que freelance, cette plateforme m'a aidé à augmenter ma clientèle de 300% en 6 mois!",
          name: 'Karim B.',
          role: 'Designer Graphique',
        },
        {
          text: "Le système de notation m'aide à faire confiance aux professionnels. Je n'ai jamais été déçu!",
          name: 'Amina L.',
          role: "Propriétaire d'Entreprise",
        },
      ],
    },
    faq: {
      title: 'Questions Fréquentes',
      items: [
        {
          question: 'Comment puis-je commencer?',
          answer:
            'Choisissez simplement si vous voulez trouver ou offrir un service, créez un compte et commencez à explorer. Cela prend moins de 2 minutes!',
        },
        {
          question: 'Le service est-il gratuit?',
          answer:
            "La création d'un compte et la navigation sont entièrement gratuites. Nous facturons seulement une petite commission sur les transactions complétées pour maintenir la plateforme.",
        },
        {
          question: 'Comment les professionnels sont-ils vérifiés?',
          answer:
            "Tous les professionnels passent par un processus de vérification incluant la vérification d'identité, l'évaluation des compétences et des vérifications d'antécédents. Nous maintenons également un système d'avis pour la transparence.",
        },
        {
          question: 'Et si je ne suis pas satisfait?',
          answer:
            "Nous offrons une garantie de satisfaction. Si vous n'êtes pas satisfait d'un service, contactez notre équipe de support dans les 48 heures, et nous travaillerons pour résoudre le problème ou fournir un remboursement.",
        },
        {
          question: 'Puis-je offrir plusieurs services?',
          answer:
            'Oui! Vous pouvez lister autant de services que vous le souhaitez sur votre profil professionnel. Cela vous aide à atteindre plus de clients dans différentes catégories.',
        },
      ],
    },
    contact: {
      title: 'Contactez-nous',
      description:
        "Vous avez des questions ou besoin d'aide? Nous sommes là pour vous aider. Contactez notre équipe de support à tout moment.",
      form: {
        name: 'Votre Nom',
        email: 'Adresse Email',
        message: 'Message',
        submit: 'Envoyer le Message',
      },
    },
    footer: {
      about: {
        title: 'À Propos de 7rayfi',
        text: 'Connecter les professionnels avec les clients à travers divers services.',
      },
      links: {
        title: 'Liens Rapides',
        about: 'À Propos',
        terms: 'Conditions de Service',
        privacy: 'Politique de Confidentialité',
      },
      support: {
        title: 'Support',
        help: "Centre d'Aide",
        contact: 'Contactez-nous',
        faq: 'FAQ',
      },
      copyright: '© 2024 7rayfi. Tous droits réservés.',
    },
  },
  ar: {
    logo: '7رايفي',
    hero: {
      title: 'ابحث عن خدمات احترافية أو قدمها',
      subtitle: 'تواصل مع محترفين مهرة أو أظهر خبرتك',
      question: 'ما الذي أتى بك إلى هنا؟',
      findService: 'البحث عن خدمة',
      offerService: 'تقديم خدمة',
      getStarted: 'ابدأ الآن',
    },
    stats: {
      professionals: 'محترفون',
      services: 'خدمات مكتملة',
      satisfaction: 'معدل الرضا',
      support: 'الدعم متاح',
    },
    howItWorks: {
      title: 'كيف يعمل',
      findPath: {
        title: 'البحث عن خدمة',
        step1: {
          title: 'البحث والتصفح',
          description: 'اعثر على محترفين حسب الفئة أو الموقع أو الخبرة',
        },
        step2: {
          title: 'المراجعة والتواصل',
          description: 'تحقق من التقييمات والمراجعات واتصل بالمحترف المناسب',
        },
        step3: {
          title: 'إنجاز العمل',
          description: 'اعمل بثقة واترك تقييمًا بعد الانتهاء',
        },
      },
      offerPath: {
        title: 'تقديم خدمة',
        step1: {
          title: 'إنشاء الملف الشخصي',
          description: 'قم بإعداد ملفك الاحترافي مع المهارات والمحفظة',
        },
        step2: {
          title: 'كن مرئيًا',
          description: 'كن مرئيًا لآلاف العملاء المحتملين في منطقتك',
        },
        step3: {
          title: 'نمو الأعمال',
          description: 'بناء السمعة من خلال المراجعات وتوسيع قاعدة عملائك',
        },
      },
    },
    testimonials: {
      title: 'ماذا يقول مستخدمونا',
      items: [
        {
          text: 'وجدت سباكًا ممتازًا في دقائق. كانت الخدمة سريعة ومهنية. أوصي بشدة!',
          name: 'سارة م.',
          role: 'صاحبة منزل',
        },
        {
          text: 'كعامل حر، ساعدتني هذه المنصة على زيادة قاعدة عملائي بنسبة 300٪ في 6 أشهر!',
          name: 'كريم ب.',
          role: 'مصمم جرافيك',
        },
        {
          text: 'يساعدني نظام التقييم على الثقة في المحترفين. لم أشعر بخيبة أمل أبدًا!',
          name: 'أمينة ل.',
          role: 'صاحبة عمل',
        },
      ],
    },
    faq: {
      title: 'الأسئلة الشائعة',
      items: [
        {
          question: 'كيف أبدأ؟',
          answer:
            'ببساطة اختر ما إذا كنت تريد العثور على خدمة أو تقديمها، أنشئ حسابًا وابدأ الاستكشاف. يستغرق الأمر أقل من دقيقتين للبدء!',
        },
        {
          question: 'هل الخدمة مجانية؟',
          answer:
            'إنشاء حساب وتصفح الخدمات مجاني تمامًا. نحن نفرض رسوم خدمة صغيرة فقط على المعاملات المكتملة للحفاظ على المنصة.',
        },
        {
          question: 'كيف يتم التحقق من المحترفين؟',
          answer:
            'يمر جميع المحترفين بعملية تحقق تشمل التحقق من الهوية وتقييم المهارات والتحقق من السجلات. نحافظ أيضًا على نظام مراجعة للشفافية.',
        },
        {
          question: 'ماذا لو لم أكن راضيًا؟',
          answer:
            'نقدم ضمان الرضا. إذا لم تكن راضيًا عن خدمة، اتصل بفريق الدعم لدينا في غضون 48 ساعة، وسنعمل على حل المشكلة أو تقديم استرداد.',
        },
        {
          question: 'هل يمكنني تقديم خدمات متعددة؟',
          answer:
            'نعم! يمكنك إدراج العديد من الخدمات كما تريد في ملفك الاحترافي. هذا يساعدك على الوصول إلى المزيد من العملاء عبر فئات مختلفة.',
        },
      ],
    },
    contact: {
      title: 'تواصل معنا',
      description:
        'لديك أسئلة أو تحتاج إلى مساعدة؟ نحن هنا للمساعدة. تواصل مع فريق الدعم لدينا في أي وقت.',
      form: {
        name: 'اسمك',
        email: 'البريد الإلكتروني',
        message: 'الرسالة',
        submit: 'إرسال الرسالة',
      },
    },
    footer: {
      about: {
        title: 'عن 7رايفي',
        text: 'ربط المحترفين بالعملاء عبر خدمات متنوعة.',
      },
      links: {
        title: 'روابط سريعة',
        about: 'من نحن',
        terms: 'شروط الخدمة',
        privacy: 'سياسة الخصوصية',
      },
      support: {
        title: 'الدعم',
        help: 'مركز المساعدة',
        contact: 'اتصل بنا',
        faq: 'الأسئلة الشائعة',
      },
      copyright: '© 2024 7رايفي. جميع الحقوق محفوظة.',
    },
  },
};

class I18n {
  constructor(defaultLang = 'en') {
    this.currentLang = this.getSavedLanguage() || defaultLang;
    this.translations = translations;
  }

  getSavedLanguage() {
    return localStorage.getItem('language');
  }

  saveLanguage(lang) {
    localStorage.setItem('language', lang);
  }

  setLanguage(lang) {
    if (!this.translations[lang]) return;
    this.currentLang = lang;
    this.saveLanguage(lang);
    this.updatePage();
    this.updateDirection();
  }

  translate(key) {
    const keys = key.split('.');
    let value = this.translations[this.currentLang];

    for (const k of keys) {
      value = value?.[k];
    }

    return value || key;
  }

  updatePage() {
    const elements = document.querySelectorAll('[data-i18n]');
    elements.forEach(el => {
      const key = el.getAttribute('data-i18n');
      const translation = this.translate(key);
      if (typeof translation === 'string') {
        if (el.tagName === 'INPUT' || el.tagName === 'TEXTAREA') {
          el.placeholder = translation;
        } else {
          el.textContent = translation;
        }
      }
    });
  }

  updateDirection() {
    const html = document.documentElement;
    const body = document.body;

    if (this.currentLang === 'ar') {
      html.setAttribute('lang', 'ar');
      html.setAttribute('dir', 'rtl');
      body.setAttribute('dir', 'rtl');
    } else {
      html.setAttribute('lang', this.currentLang);
      html.removeAttribute('dir');
      body.removeAttribute('dir');
    }
  }
}

class Carousel {
  constructor(containerSelector) {
    this.container = document.querySelector(containerSelector);
    if (!this.container) return;

    this.track = this.container.querySelector('.carousel-track');
    this.cards = Array.from(this.track.querySelectorAll('.testimonial-card'));
    this.prevButton = document.getElementById('carousel-prev');
    this.nextButton = document.getElementById('carousel-next');
    this.dotsContainer = document.querySelector('.carousel-dots');

    this.currentIndex = 0;
    this.init();
  }

  init() {
    this.createDots();
    this.updateCarousel();
    this.setupEventListeners();
    this.startAutoplay();
  }

  createDots() {
    if (!this.dotsContainer) return;

    this.cards.forEach((_, index) => {
      const dot = document.createElement('button');
      dot.className = 'carousel-dot';
      dot.setAttribute('role', 'tab');
      dot.setAttribute('aria-label', `Go to testimonial ${index + 1}`);
      dot.addEventListener('click', () => this.goToSlide(index));
      this.dotsContainer.appendChild(dot);
    });

    this.dots = Array.from(this.dotsContainer.querySelectorAll('.carousel-dot'));
  }

  setupEventListeners() {
    if (this.prevButton) {
      this.prevButton.addEventListener('click', () => this.prev());
    }
    if (this.nextButton) {
      this.nextButton.addEventListener('click', () => this.next());
    }

    let touchStartX = 0;
    let touchEndX = 0;

    this.container.addEventListener('touchstart', e => {
      touchStartX = e.changedTouches[0].screenX;
    });

    this.container.addEventListener('touchend', e => {
      touchEndX = e.changedTouches[0].screenX;
      this.handleSwipe(touchStartX, touchEndX);
    });
  }

  handleSwipe(startX, endX) {
    const diff = startX - endX;
    if (Math.abs(diff) > 50) {
      if (diff > 0) {
        this.next();
      } else {
        this.prev();
      }
    }
  }

  prev() {
    this.currentIndex = this.currentIndex > 0 ? this.currentIndex - 1 : this.cards.length - 1;
    this.updateCarousel();
    this.resetAutoplay();
  }

  next() {
    this.currentIndex = this.currentIndex < this.cards.length - 1 ? this.currentIndex + 1 : 0;
    this.updateCarousel();
    this.resetAutoplay();
  }

  goToSlide(index) {
    this.currentIndex = index;
    this.updateCarousel();
    this.resetAutoplay();
  }

  updateCarousel() {
    const offset = -this.currentIndex * 100;
    this.track.style.transform = `translateX(${offset}%)`;

    if (this.prevButton) {
      this.prevButton.disabled = false;
    }
    if (this.nextButton) {
      this.nextButton.disabled = false;
    }

    if (this.dots) {
      this.dots.forEach((dot, index) => {
        if (index === this.currentIndex) {
          dot.classList.add('active');
          dot.setAttribute('aria-selected', 'true');
        } else {
          dot.classList.remove('active');
          dot.setAttribute('aria-selected', 'false');
        }
      });
    }
  }

  startAutoplay() {
    this.autoplayInterval = setInterval(() => {
      this.next();
    }, 5000);
  }

  resetAutoplay() {
    clearInterval(this.autoplayInterval);
    this.startAutoplay();
  }
}

class FAQ {
  constructor() {
    this.items = document.querySelectorAll('.faq-item');
    this.init();
  }

  init() {
    this.items.forEach(item => {
      const question = item.querySelector('.faq-question');
      const answer = item.querySelector('.faq-answer');

      question.addEventListener('click', () => {
        const isExpanded = question.getAttribute('aria-expanded') === 'true';

        this.items.forEach(otherItem => {
          const otherQuestion = otherItem.querySelector('.faq-question');
          const otherAnswer = otherItem.querySelector('.faq-answer');
          otherQuestion.setAttribute('aria-expanded', 'false');
          otherAnswer.style.maxHeight = null;
        });

        if (!isExpanded) {
          question.setAttribute('aria-expanded', 'true');
          answer.style.maxHeight = answer.scrollHeight + 'px';
        }
      });
    });
  }
}

class OrientationToggle {
  constructor() {
    this.buttons = document.querySelectorAll('.btn-toggle');
    this.ctaButton = document.getElementById('cta-button');
    this.selectedMode = 'find';
    this.init();
  }

  init() {
    this.buttons.forEach(button => {
      button.addEventListener('click', () => {
        const mode = button.getAttribute('data-mode');
        this.selectMode(mode);
      });
    });

    this.ctaButton?.addEventListener('click', () => {
      this.handleCTA();
    });
  }

  selectMode(mode) {
    this.selectedMode = mode;
    this.buttons.forEach(button => {
      const buttonMode = button.getAttribute('data-mode');
      if (buttonMode === mode) {
        button.classList.add('active');
        button.setAttribute('aria-pressed', 'true');
      } else {
        button.classList.remove('active');
        button.setAttribute('aria-pressed', 'false');
      }
    });
  }

  handleCTA() {
    if (this.selectedMode === 'find') {
      console.log('Redirecting to search page...');
      window.location.href = '/search.html';
    } else {
      console.log('Redirecting to signup page...');
      window.location.href = '/signup.html';
    }
  }
}

class ContactForm {
  constructor() {
    this.form = document.getElementById('contact-form');
    this.init();
  }

  init() {
    if (!this.form) return;

    this.form.addEventListener('submit', e => {
      e.preventDefault();
      this.handleSubmit();
    });
  }

  async handleSubmit() {
    const formData = new FormData(this.form);
    const data = Object.fromEntries(formData.entries());

    const submitButton = this.form.querySelector('button[type="submit"]');
    const originalText = submitButton.textContent;
    submitButton.disabled = true;
    submitButton.textContent = 'Sending...';

    try {
      await new Promise(resolve => setTimeout(resolve, 1000));

      console.log('Contact form submitted:', data);

      alert('Thank you for your message! We will get back to you soon.');
      this.form.reset();
    } catch (error) {
      console.error('Error submitting form:', error);
      alert('There was an error sending your message. Please try again.');
    } finally {
      submitButton.disabled = false;
      submitButton.textContent = originalText;
    }
  }
}

document.addEventListener('DOMContentLoaded', () => {
  const i18n = new I18n();

  const languageSelector = document.getElementById('language-selector');
  if (languageSelector) {
    languageSelector.value = i18n.currentLang;
    languageSelector.addEventListener('change', e => {
      i18n.setLanguage(e.target.value);
    });
  }

  i18n.updatePage();
  i18n.updateDirection();

  new Carousel('.carousel-container');
  new FAQ();
  new OrientationToggle();
  new ContactForm();

  const observer = new IntersectionObserver(
    entries => {
      entries.forEach(entry => {
        if (entry.isIntersecting) {
          entry.target.style.opacity = '1';
          entry.target.style.transform = 'translateY(0)';
        }
      });
    },
    {
      threshold: 0.1,
      rootMargin: '0px 0px -50px 0px',
    }
  );

  document.querySelectorAll('.section').forEach(section => {
    section.style.opacity = '0';
    section.style.transform = 'translateY(20px)';
    section.style.transition = 'opacity 0.6s ease-out, transform 0.6s ease-out';
    observer.observe(section);
  });
});
